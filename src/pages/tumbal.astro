---
/**
 * TUMBAL - Tabel Urut Mudah Buat Analisa Lanjutan
 *
 * Filosofi: Mengorbankan tabel lama yang jelek
 * demi mendapatkan kekayaan data (insight) yang melimpah.
 */
import ToolPageLayout from "../layouts/ToolPageLayout.astro";
import FileUploader from "../components/TUMBAL/FileUploader.astro";
import RawPreview from "../components/TUMBAL/RawPreview.astro";
import HeaderSelector from "../components/TUMBAL/HeaderSelector.astro";
import ConvertedPreview from "../components/TUMBAL/ConvertedPreview.astro";
import DownloadButtons from "../components/TUMBAL/DownloadButtons.astro";

const title = "TUMBAL - Tabel Urut Mudah Buat Analisa Lanjutan";
const description =
  "Konversi tabel dengan nested headers dan merged cells menjadi format rapi untuk analisa lanjutan.";
---

<ToolPageLayout
  title={title}
  subtitle="TUMBAL"
  description={description}
  themeColor="candy-orange"
  icon="lucide:skull"
>
  <div slot="header-extra">
    <p
      class="text-zinc-600 dark:text-zinc-400 leading-relaxed text-sm sm:text-base italic mt-1"
    >
      "Mengorbankan tabel lama yang jelek demi mendapatkan kekayaan data yang
      melimpah. Contohnya tabel BPS."
    </p>
  </div>

  {/* Step 1: Upload */}
  <div class="mb-8">
    <div class="flex items-center gap-3 mb-4">
      <div
        class="w-8 h-8 rounded-full bg-candy-orange/20 flex items-center justify-center font-bold text-[color:color-mix(in_srgb,var(--candy-orange),black_40%)] dark:text-[color:color-mix(in_srgb,var(--candy-orange),white_30%)]"
      >
        1
      </div>
      <h2 class="text-lg font-bold text-zinc-800 dark:text-zinc-100">
        Upload Tabel Korban
      </h2>
    </div>
    <FileUploader />
  </div>

  {/* Step 2: Raw Preview */}
  <div class="mb-8">
    <div id="step-2-header" class="flex items-center gap-3 mb-4 hidden">
      <div
        class="w-8 h-8 rounded-full bg-candy-orange/20 flex items-center justify-center font-bold text-[color:color-mix(in_srgb,var(--candy-orange),black_40%)] dark:text-[color:color-mix(in_srgb,var(--candy-orange),white_30%)]"
      >
        2
      </div>
      <h2 class="text-lg font-bold text-zinc-800 dark:text-zinc-100">
        Preview Tabel Asli
      </h2>
    </div>
    <RawPreview />
  </div>

  {/* Step 3 & 4: Side by Side - Config & Preview */}
  <div id="config-preview-section" class="hidden mb-8">
    <div class="grid lg:grid-cols-2 gap-6 lg:items-start">
      {/* Left: Configuration - scrollable */}
      <div>
        <div class="flex items-center gap-3 mb-4">
          <div
            class="w-8 h-8 rounded-full bg-candy-orange/20 flex items-center justify-center font-bold text-[color:color-mix(in_srgb,var(--candy-orange),black_40%)] dark:text-[color:color-mix(in_srgb,var(--candy-orange),white_30%)]"
          >
            3
          </div>
          <h2 class="text-lg font-bold text-zinc-800 dark:text-zinc-100">
            Konfigurasi Ritual
          </h2>
        </div>
        <HeaderSelector />
      </div>

      {/* Right: Preview - sticky column */}
      <div class="lg:sticky lg:top-8 lg:self-start h-fit">
        <div class="flex items-center gap-3 mb-4">
          <div
            class="w-8 h-8 rounded-full bg-candy-orange/20 flex items-center justify-center font-bold text-[color:color-mix(in_srgb,var(--candy-orange),black_40%)] dark:text-[color:color-mix(in_srgb,var(--candy-orange),white_30%)]"
          >
            4
          </div>
          <h2 class="text-lg font-bold text-zinc-800 dark:text-zinc-100">
            Hasil Konversi
          </h2>
        </div>
        <ConvertedPreview />
      </div>
    </div>
  </div>

  {/* Step 5: Download */}
  <div class="mb-8">
    <div id="step-5-header" class="flex items-center gap-3 mb-4 hidden">
      <div
        class="w-8 h-8 rounded-full bg-candy-orange/20 flex items-center justify-center font-bold text-[color:color-mix(in_srgb,var(--candy-orange),black_40%)] dark:text-[color:color-mix(in_srgb,var(--candy-orange),white_30%)]"
      >
        5
      </div>
      <h2 class="text-lg font-bold text-zinc-800 dark:text-zinc-100">
        Download
      </h2>
    </div>
    <DownloadButtons />
  </div>
</ToolPageLayout>

<script>
  function initTumbalPage() {
    const step2Header = document.getElementById("step-2-header");
    const configPreviewSection = document.getElementById(
      "config-preview-section",
    );
    const step5Header = document.getElementById("step-5-header");

    // Show step headers when file is uploaded
    window.addEventListener("tumbal-file-uploaded", () => {
      step2Header?.classList.remove("hidden");
      configPreviewSection?.classList.remove("hidden");
      step5Header?.classList.remove("hidden");
    });

    // Hide step headers when file is cleared
    window.addEventListener("tumbal-file-cleared", () => {
      step2Header?.classList.add("hidden");
      configPreviewSection?.classList.add("hidden");
      step5Header?.classList.add("hidden");
    });
  }

  // Initialize
  if (typeof window !== "undefined") {
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initTumbalPage);
    } else {
      initTumbalPage();
    }
  }
</script>

<style>
  /* Make the side-by-side section components not show their hidden state initially */
  #config-preview-section :global(#tumbal-header-selector),
  #config-preview-section :global(#tumbal-converted-preview) {
    display: block !important;
  }
</style>
